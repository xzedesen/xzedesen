<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <title>Signup | Xzedesen - Verified Social Network</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    * { 
      margin: 0; padding: 0; box-sizing: border-box; 
      font-family: 'Poppins', sans-serif; 
    }
    
    html, body { 
      height: 100%; width: 100%; overflow-x: hidden; 
    }
    
    body {
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
      min-height: 100vh;
      display: flex; 
      justify-content: center; 
      align-items: center;
      color: #fff; 
      padding: 15px;
    }

    .signup-container {
      background: rgba(30, 30, 50, 0.95);
      -webkit-backdrop-filter: blur(15px);
      backdrop-filter: blur(15px);
      border-radius: 16px;
      box-shadow: 0 15px 35px rgba(0,0,0,0.3);
      width: 100%; 
      max-width: 480px;
      padding: 30px 25px; 
      text-align: center;
      border: 1px solid rgba(255,255,255,0.15);
    }

    .logo h1 {
      font-size: 2.5rem; 
      font-weight: 800;
      background: linear-gradient(45deg,#ff6b6b,#ff8e53,#ff6b6b);
      -webkit-background-clip: text; 
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin-bottom: 5px;
      text-shadow: 0 0 20px rgba(255,107,107,0.5);
    }

    .logo p {
      color: rgba(255,255,255,0.8);
      margin-bottom: 20px;
      font-size: 0.9rem;
    }

    .signup-form { 
      text-align: left; 
    }

    .form-group { 
      margin-bottom: 15px; 
    }

    .form-group label { 
      display: block; 
      margin-bottom: 5px; 
      font-weight: 500;
      color: rgba(255,255,255,0.9);
      font-size: 0.9rem;
    }

    .form-group input, .form-group select {
      width: 100%; 
      padding: 14px 16px; 
      border-radius: 10px;
      border: 1px solid rgba(255,255,255,0.2);
      background: rgba(255,255,255,0.08);
      color: #fff; 
      font-size: 14px;
      transition: all 0.3s ease;
    }

    .form-group input::placeholder { 
      color: rgba(255,255,255,0.5); 
    }

    .form-group input:focus, .form-group select:focus {
      outline: none;
      border-color: rgba(255,107,107,0.6);
      background: rgba(255,255,255,0.12);
      box-shadow: 0 0 0 3px rgba(255,107,107,0.2);
    }

    .username-status {
      font-size: 11px;
      margin-top: 3px;
      height: 12px;
    }

    .username-available {
      color: #4ecdc4;
    }

    .username-taken {
      color: #ff6b6b;
    }

    .row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
    }

    .file-upload {
      position: relative;
      border: 2px dashed rgba(255,255,255,0.3);
      border-radius: 10px;
      padding: 20px;
      text-align: center;
      transition: all 0.3s ease;
      cursor: pointer;
      margin-top: 5px;
    }

    .file-upload:hover {
      border-color: rgba(255,107,107,0.6);
      background: rgba(255,107,107,0.05);
    }

    .file-upload i {
      font-size: 1.8rem;
      color: rgba(255,107,107,0.7);
      margin-bottom: 8px;
    }

    .file-upload p {
      font-size: 0.9rem;
      margin-bottom: 3px;
    }

    .file-upload input {
      position: absolute;
      width: 100%;
      height: 100%;
      top: 0;
      left: 0;
      opacity: 0;
      cursor: pointer;
    }

    .preview-container {
      margin-top: 10px;
      display: none;
    }

    .preview-image {
      max-width: 120px;
      max-height: 120px;
      border-radius: 8px;
      border: 2px solid rgba(255,107,107,0.5);
    }

    .signup-btn {
      width: 100%; 
      padding: 16px; 
      margin-top: 20px;
      background: linear-gradient(45deg,#ff6b6b,#ff8e53);
      border: none; 
      border-radius: 10px; 
      color: white;
      font-size: 16px; 
      font-weight: 600; 
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .signup-btn:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(255,107,107,0.4);
    }

    .signup-btn:disabled {
      background: rgba(255,255,255,0.2);
      cursor: not-allowed;
      opacity: 0.6;
    }

    .error-message { 
      color: #ff6b6b; 
      font-size: 13px; 
      margin-top: 8px; 
      min-height: 16px; 
      text-align: center;
    }

    /* Responsive */
    @media (max-width: 600px) {
      .signup-container {
        padding: 25px 20px;
        margin: 5px;
      }
      
      .row {
        grid-template-columns: 1fr;
      }
      
      .logo h1 {
        font-size: 2.2rem;
      }
    }

    @media (max-width: 400px) {
      .signup-container {
        padding: 20px 15px;
      }
      
      .logo h1 {
        font-size: 2rem;
      }
      
      .form-group input, .form-group select {
        padding: 12px 14px;
      }
    }
  </style>
</head>
<body>
  <div class="signup-container">
    <div class="logo">
      <h1>Xzedesen</h1>
      <p>Join the verified elite community</p>
    </div>

    <form class="signup-form" id="signupForm">
      <div class="form-group">
        <label for="username">Username*</label>
        <input type="text" id="username" required placeholder="Choose your unique username">
        <div class="username-status" id="usernameStatus"></div>
      </div>

      <div class="form-group">
        <label for="password">Password*</label>
        <input type="password" id="password" required minlength="6" placeholder="Create a strong password">
      </div>

      <div class="form-group">
        <label for="fullname">Full Name*</label>
        <input type="text" id="fullname" required placeholder="Enter your full name">
      </div>

      <div class="row">
        <div class="form-group">
          <label for="gender">Gender*</label>
          <select id="gender" required>
            <option value="">Select Gender</option>
            <option value="Male">Male</option>
            <option value="Female">Female</option>
            <option value="Other">Other</option>
          </select>
        </div>

        <div class="form-group">
          <label for="dob">Date of Birth*</label>
          <input type="date" id="dob" required>
        </div>
      </div>

      <div class="form-group">
        <label>Upload Profile Picture*</label>
        <div class="file-upload">
          <i class="fas fa-cloud-upload-alt"></i>
          <p>Click to upload your photo</p>
          <p style="font-size: 11px; opacity: 0.7;">Max size: 5MB</p>
          <input type="file" id="selfie" accept="image/*" required>
        </div>
        <div class="preview-container" id="previewContainer">
          <img class="preview-image" id="previewImage" alt="Preview">
        </div>
      </div>

      <div id="signupError" class="error-message"></div>
      
      <button type="submit" class="signup-btn" id="signupBtn" disabled>
        <i class="fas fa-user-plus"></i> CREATE VERIFIED ACCOUNT
      </button>
    </form>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-app.js";
    import { getAuth, createUserWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-auth.js";
    import { getFirestore, doc, setDoc, serverTimestamp, collection, query, where, getDocs } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-firestore.js";
    import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-storage.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDEBKGAsMF8woHBpOY5OK4isHGA_anAEPs",
      authDomain: "xzedesen-916ea.firebaseapp.com",
      projectId: "xzedesen-916ea",
      storageBucket: "xzedesen-916ea.firebasestorage.app",
      messagingSenderId: "1019829731381",
      appId: "1:1019829731381:web:e987812821dd660578317c"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);
    const storage = getStorage(app);

    const signupForm = document.getElementById("signupForm");
    const signupError = document.getElementById("signupError");
    const usernameInput = document.getElementById("username");
    const usernameStatus = document.getElementById("usernameStatus");
    const signupBtn = document.getElementById("signupBtn");
    const selfieInput = document.getElementById("selfie");
    const previewContainer = document.getElementById("previewContainer");
    const previewImage = document.getElementById("previewImage");

    let isUsernameAvailable = false;
    let usernameCheckTimeout = null;

    usernameInput.addEventListener("input", function() {
      const username = this.value.trim();
      
      if (usernameCheckTimeout) {
        clearTimeout(usernameCheckTimeout);
      }
      
      usernameStatus.textContent = "";
      isUsernameAvailable = false;
      updateSignupButton();
      
      if (username.length < 3) {
        usernameStatus.textContent = "Username must be at least 3 characters";
        usernameStatus.className = "username-status username-taken";
        return;
      }
      
      if (!/^[a-zA-Z0-9_]+$/.test(username)) {
        usernameStatus.textContent = "Only letters, numbers and underscore allowed";
        usernameStatus.className = "username-status username-taken";
        return;
      }
      
      usernameCheckTimeout = setTimeout(async () => {
        try {
          const usersRef = collection(db, "users");
          const q = query(usersRef, where("username", "==", username));
          const querySnapshot = await getDocs(q);
          
          if (querySnapshot.empty) {
            usernameStatus.textContent = "✓ Username is available";
            usernameStatus.className = "username-status username-available";
            isUsernameAvailable = true;
          } else {
            usernameStatus.textContent = "✗ Username already taken";
            usernameStatus.className = "username-status username-taken";
            isUsernameAvailable = false;
          }
          updateSignupButton();
        } catch (error) {
          console.error("Error checking username:", error);
          usernameStatus.textContent = "Error checking username availability";
          usernameStatus.className = "username-status username-taken";
          isUsernameAvailable = false;
          updateSignupButton();
        }
      }, 500);
    });

    function updateSignupButton() {
      const username = usernameInput.value.trim();
      const password = document.getElementById("password").value.trim();
      const fullname = document.getElementById("fullname").value.trim();
      const dob = document.getElementById("dob").value;
      const gender = document.getElementById("gender").value;
      const selfieFile = selfieInput.files[0];
      
      const allFieldsFilled = username && password && fullname && dob && gender && selfieFile;
      
      signupBtn.disabled = !(allFieldsFilled && isUsernameAvailable);
    }

    document.getElementById("password").addEventListener("input", updateSignupButton);
    document.getElementById("fullname").addEventListener("input", updateSignupButton);
    document.getElementById("dob").addEventListener("input", updateSignupButton);
    document.getElementById("gender").addEventListener("change", updateSignupButton);

    selfieInput.addEventListener("change", function(e) {
      const file = e.target.files[0];
      if (file) {
        if (file.size > 5 * 1024 * 1024) {
          signupError.textContent = "Image size must be less than 5MB";
          return;
        }
        
        const reader = new FileReader();
        reader.onload = function(e) {
          previewImage.src = e.target.result;
          previewContainer.style.display = "block";
          updateSignupButton();
        }
        reader.readAsDataURL(file);
      }
    });

    signupForm.addEventListener("submit", async (e) => {
      e.preventDefault();

      const username = usernameInput.value.trim();
      const password = document.getElementById("password").value.trim();
      const fullname = document.getElementById("fullname").value.trim();
      const dob = document.getElementById("dob").value;
      const gender = document.getElementById("gender").value;
      const selfieFile = selfieInput.files[0];

      if (!isUsernameAvailable) {
        signupError.textContent = "Please choose an available username";
        return;
      }

      if (password.length < 6) {
        signupError.textContent = "Password must be at least 6 characters";
        return;
      }

      const email = username + "@xzedesen.com";

      try {
        signupBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> CREATING ACCOUNT...';
        signupBtn.disabled = true;

        const userCredential = await createUserWithEmailAndPassword(auth, email, password);
        const uid = userCredential.user.uid;

        const storageRef = ref(storage, `users/${uid}/profile.jpg`);
        await uploadBytes(storageRef, selfieFile);
        const photoURL = await getDownloadURL(storageRef);

        await setDoc(doc(db, "users", uid), {
          username,
          fullname,
          dob,
          gender,
          photoURL,
          email,
          role: "user",
          isAdmin: false,
          verified: false,
          createdAt: serverTimestamp()
        });

        signupBtn.innerHTML = '<i class="fas fa-check"></i> ACCOUNT CREATED!';
        signupBtn.style.background = "linear-gradient(45deg,#4ecdc4,#42b883)";
        
        setTimeout(() => {
          window.location.href = "welcome.html";
        }, 1500);

      } catch (err) {
        console.error("Signup Error:", err);
        signupError.textContent = err.message;
        
        signupBtn.innerHTML = '<i class="fas fa-user-plus"></i> CREATE VERIFIED ACCOUNT';
        signupBtn.disabled = false;
        updateSignupButton();
      }
    });
  </script>
</body>
</html>
