<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Signup | Xzedesen</title>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:Poppins,sans-serif;}
body{
  min-height:100vh;
  display:flex;
  justify-content:center;
  align-items:center;
  background:linear-gradient(135deg,#1a1a2e,#16213e,#0f3460);
  color:#fff;
  padding:20px;
  overflow:hidden;
}

/* ===== MORE BUBBLES ===== */
.bg-bubbles{
  position:fixed;
  top:0;left:0;
  width:100%;height:100%;
  z-index:-1;
}
.bg-bubbles li{
  position:absolute;
  list-style:none;
  width:40px;height:40px;
  background:rgba(255,255,255,0.12);
  bottom:-200px;
  animation:floatUp linear infinite;
  border-radius:50%;
}
@keyframes floatUp{
  0%{transform:translateY(0) scale(1);opacity:1;}
  100%{transform:translateY(-1300px) scale(1.3);opacity:0;}
}

/* bubble variations */
.bg-bubbles li:nth-child(odd){background:rgba(255,255,255,0.08);}
.bg-bubbles li:nth-child(1){left:5%;width:40px;height:40px;animation-duration:18s;}
.bg-bubbles li:nth-child(2){left:12%;width:70px;height:70px;animation-duration:25s;}
.bg-bubbles li:nth-child(3){left:20%;width:55px;height:55px;animation-duration:22s;}
.bg-bubbles li:nth-child(4){left:30%;width:90px;height:90px;animation-duration:30s;}
.bg-bubbles li:nth-child(5){left:40%;width:45px;height:45px;animation-duration:20s;}
.bg-bubbles li:nth-child(6){left:50%;width:100px;height:100px;animation-duration:35s;}
.bg-bubbles li:nth-child(7){left:60%;width:60px;height:60px;animation-duration:26s;}
.bg-bubbles li:nth-child(8){left:68%;width:80px;height:80px;animation-duration:28s;}
.bg-bubbles li:nth-child(9){left:75%;width:50px;height:50px;animation-duration:19s;}
.bg-bubbles li:nth-child(10){left:82%;width:120px;height:120px;animation-duration:38s;}
.bg-bubbles li:nth-child(11){left:88%;width:65px;height:65px;animation-duration:24s;}
.bg-bubbles li:nth-child(12){left:94%;width:45px;height:45px;animation-duration:21s;}

/* ===== FORM ===== */
.box{
  width:100%;
  max-width:500px;
  background:rgba(30,30,50,.95);
  border-radius:16px;
  padding:30px 25px;
  box-shadow:0 15px 40px rgba(0,0,0,.45);
}
h1{
  text-align:center;
  margin-bottom:6px;
  background:linear-gradient(45deg,#ff6b6b,#ff8e53);
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
}
p{text-align:center;font-size:14px;opacity:.85;margin-bottom:20px;}

.group{margin-bottom:14px;}
label{display:block;font-size:13px;margin-bottom:6px;}
input,select{
  width:100%;
  padding:13px 15px;
  border-radius:10px;
  border:1px solid rgba(255,255,255,.2);
  background:rgba(255,255,255,.08);
  color:#fff;
}
input::placeholder{color:rgba(255,255,255,.5);}
.row{display:grid;grid-template-columns:1fr 1fr;gap:10px;}

.upload{
  border:2px dashed rgba(255,255,255,.3);
  padding:18px;
  text-align:center;
  border-radius:10px;
  cursor:pointer;
}
.upload:hover{border-color:#ff6b6b;}
.preview{display:none;margin-top:10px;}
.preview img{max-width:110px;border-radius:8px;border:2px solid #ff6b6b;}

.status{font-size:12px;margin-top:4px;}
.error{font-size:13px;color:#ff6b6b;text-align:center;margin:10px 0;}

button{
  width:100%;
  padding:16px;
  border:none;
  border-radius:12px;
  font-size:16px;
  font-weight:600;
  cursor:pointer;
  background:linear-gradient(45deg,#ff6b6b,#ff8e53);
  color:#fff;
  margin-top:12px;
}
button:disabled{opacity:.5;cursor:not-allowed;}

.consent{
  font-size:12px;
  display:flex;
  gap:8px;
  margin-top:12px;
}
</style>
</head>

<body>

<ul class="bg-bubbles">
<li></li><li></li><li></li><li></li><li></li><li></li>
<li></li><li></li><li></li><li></li><li></li><li></li>
</ul>

<div class="box">
<h1>Xzedesen</h1>
<p>Registration request → Physical ID verification by admin</p>

<form id="form">

<!-- Full name -->
<div class="group">
<label>Full Name</label>
<input id="fullname" required placeholder="Your full name">
</div>

<!-- DOB -->
<div class="group">
<label>Date of Birth</label>
<input type="date" id="dob" required>
</div>

<!-- Username -->
<div class="group">
<label>Username</label>
<input id="username" placeholder="Suggested username will appear" required>
<div id="uStatus" class="status"></div>
</div>

<!-- Passwords -->
<div class="row">
<div class="group">
<label>Password</label>
<input type="password" id="pass" required minlength="6">
</div>
<div class="group">
<label>Retype Password</label>
<input type="password" id="repass" required minlength="6">
</div>
</div>

<!-- Gender & DOB -->
<div class="row">
<div class="group">
<label>Gender</label>
<select id="gender" required>
<option value="">Select</option>
<option>Male</option>
<option>Female</option>
<option>Other</option>
</select>
</div>
<div class="group">
<label>State</label>
<select id="state" required></select>
</div>
</div>

<div class="group">
<label>City</label>
<select id="city" required></select>
</div>

<!-- Photo -->
<div class="group">
<label>Profile Photo</label>
<div class="upload" id="uploadBox">Click to upload photo</div>
<input type="file" id="photo" hidden accept="image/*" required>
<div class="preview" id="preview"><img id="img"></div>
</div>

<!-- Consent -->
<div class="consent">
<input type="checkbox" id="consent">
<span>
I agree to visit the admin for <b>physical identity verification</b> with a valid government photo ID.  
<br><small>No Aadhaar / ID number is collected online.</small>
</span>
</div>

<div class="error" id="err"></div>
<button id="btn" disabled>Submit for Verification</button>

</form>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-app.js";
import { getAuth, createUserWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-auth.js";
import { getFirestore, doc, setDoc, collection, query, where, getDocs, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-firestore.js";
import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-storage.js";

const app = initializeApp({
  apiKey:"AIzaSyDEBKGAsMF8woHBpOY5OK4isHGA_anAEPs",
  authDomain:"xzedesen-916ea.firebaseapp.com",
  projectId:"xzedesen-916ea",
  storageBucket:"xzedesen-916ea.appspot.com",
  messagingSenderId:"1019829731381",
  appId:"1:1019829731381:web:e987812821dd660578317c"
});

const auth=getAuth(app);
const db=getFirestore(app);
const storage=getStorage(app);
const $=id=>document.getElementById(id);

let usernameOk=false;

/* Load cities */
fetch("https://raw.githubusercontent.com/xzedesen/xzedesen-site/main/cities.json")
.then(r=>r.json())
.then(d=>{
  state.innerHTML='<option value="">Select State</option>';
  for(const s in d){state.innerHTML+=`<option>${s}</option>`;}
  state.onchange=()=>{city.innerHTML='<option value="">Select City</option>';d[state.value]?.forEach(c=>city.innerHTML+=`<option>${c}</option>`);}
});

/* Auto-suggest username */
async function suggestUsername(){
  if(!fullname.value || !dob.value) return;
  const year=dob.value.split("-")[0];
  const base=fullname.value.toLowerCase().replace(/\s+/g,'')+year;
  let final=base, i=0;
  while(true){
    const q=query(collection(db,"users"),where("username","==",final));
    const s=await getDocs(q);
    if(s.empty) break;
    i++; final=base+"_"+i;
  }
  username.value=final;
  uStatus.textContent="✓ Suggested & available";
  uStatus.style.color="#4ecdc4";
  usernameOk=true;
  check();
}
fullname.oninput=suggestUsername;
dob.onchange=suggestUsername;

/* Manual username check */
username.oninput=async()=>{
  const u=username.value.trim();
  if(u.length<3){uStatus.textContent="Min 3 characters";uStatus.style.color="orange";usernameOk=false;return;}
  const q=query(collection(db,"users"),where("username","==",u));
  const s=await getDocs(q);
  if(s.empty){uStatus.textContent="✓ Username available";uStatus.style.color="#4ecdc4";usernameOk=true;}
  else{uStatus.textContent="✗ Username taken";uStatus.style.color="#ff6b6b";usernameOk=false;}
  check();
};

/* Photo */
uploadBox.onclick=()=>photo.click();
photo.onchange=e=>{
  const f=e.target.files[0];
  const r=new FileReader();
  r.onload=()=>{img.src=r.result;preview.style.display="block";}
  r.readAsDataURL(f);
  check();
};

document.querySelectorAll("input,select").forEach(e=>e.oninput=check);

/* Enable button */
function check(){
btn.disabled=!(
fullname.value &&
dob.value &&
username.value &&
usernameOk &&
pass.value &&
pass.value===repass.value &&
gender.value &&
state.value &&
city.value &&
photo.files[0] &&
consent.checked
);
}

/* Submit */
form.onsubmit=async e=>{
e.preventDefault();
try{
const email=username.value+"@xzedesen.com";
const cred=await createUserWithEmailAndPassword(auth,email,pass.value);
const uid=cred.user.uid;
const r=ref(storage,"users/"+uid+"/photo.jpg");
await uploadBytes(r,photo.files[0]);
const url=await getDownloadURL(r);
await setDoc(doc(db,"users",uid),{
username:username.value,
fullname:fullname.value,
dob:dob.value,
gender:gender.value,
state:state.value,
city:city.value,
photo:url,
verified:false,
createdAt:serverTimestamp()
});
alert("Submitted successfully. Contact admin for verification.");
form.reset();
}catch(err){errDiv.textContent=err.message;}
};
</script>

</body>
</html>
